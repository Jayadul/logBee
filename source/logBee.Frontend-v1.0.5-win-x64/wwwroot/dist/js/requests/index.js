define(["logBee","js/templates","jquery","js/visitorCookie","js/components/tables/RequestsTable","js/components/searchTable/FilterConstructor","js/components/searchTable/SortOperator","chart-js","luxon","js/chart-utils"],function(u,c,d,p,h,f,m,g,C,b){return{init:function(t){p.setOrganizationId(t.organizationId);var e=u.htmlDecode(d("#page-model").html()),e=JSON.parse(e);if(e.usage&&(o=c.renderTemplate("plan-usage-notification/card",{organization:e.organization,usage:e.usage}),d("#content").prepend(o.html)),e.httpTrafficChartData){for(var a=e.httpTrafficChartData,o=d("#http-traffic-chart"),r=[],n=0,l=a.intervals.length;n<l;n++)r.push(a.intervals[n].from);o=o[0].getContext("2d"),new g(o,{type:"line",options:{onResize:function(t,e){e=e.width;const o=800<=e?1:480<=e?3:4;t.options.scales.x.ticks.callback=function(t,e,a){return(t+1)%o!=0?null:(t=this.getLabelForValue(t),C.DateTime.fromISO(t).toFormat("dd-MM"))}},responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},tooltip:{intersect:!1,mode:"index",callbacks:{title:function(t,e){t=t[0].label;return C.DateTime.fromISO(t).toFormat("dd MMMM")}}},verticalLiner:{lineWidth:3,color:"#282c34"}},scales:{y:{beginAtZero:!0,position:"right"},x:{ticks:{}}},elements:{point:{radius:0},line:{borderWidth:2}}},plugins:[b.verticalLinerPlugin],data:{labels:r,datasets:[{label:"Server errors",fill:!0,backgroundColor:b.statusCode500BackgroundGradient(o,100),borderColor:b.statusCode500BorderColor(),data:a.intervals.map(function(a){let o=0;for(let t=0,e=a.value.length;t<e;t++)500<=a.value[t].httpStatusCode&&(o+=a.value[t].count);return o})},{label:"Client errors",fill:!0,backgroundColor:b.statusCode400BackgroundGradient(o,100),borderColor:b.statusCode400BorderColor(),data:a.intervals.map(function(a){let o=0;for(let t=0,e=a.value.length;t<e;t++)400<=a.value[t].httpStatusCode&&a.value[t].httpStatusCode<500&&(o+=a.value[t].count);return o})},{label:"Success",fill:!0,backgroundColor:b.statusCode200BackgroundGradient(o,100),borderColor:b.statusCode200BorderColor(),data:a.intervals.map(function(a){let o=0;for(let t=0,e=a.value.length;t<e;t++)a.value[t].httpStatusCode<400&&(o+=a.value[t].count);return o})}]}})}var e=new h({$container:d("#requestsTable-container"),urlParams:function(){return{applicationId:t.applicationId}},hasKeywordsSearch:!0}),i=d("#keywords-tooptip-template").html(),s=e.getKeywordsForm(),i=(s.find("button[type='submit']").after(i),s.find("[data-popover-id]").each(function(){u.bindPopover(d(this))}),new URL(window.location.href)),s=i.searchParams.get("filterBase64"),s=(s&&(s=f.fromUriComponent(s),e.searchTable.applyFilter(s)),i.searchParams.get("sort")),i=s?m.fromUriComponent(s):new m("StartDateTime","desc");e.searchTable.applySort(i)}}});