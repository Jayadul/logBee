define(["logBee","jquery","ko","bootstrap","countryTimeZone"],function(s,d,r,l,c){window.onUpdateBillingDetailsComplete=function(t,e){s.toggleFormLoading(this,!1),"success"!==e&&s.showXhrErrorToast(t),"success"===e&&s.showToast({body:"Billing details have been updated",type:"success"})};let p=!1;function u(){var t=(e=d("#update-billing-details-form")).find("[data-company-container]"),e=e.find("input[name='IsCompany']:checked").val();/true$/i.test(e)&&(t.find("input,textarea,select").prop("disabled",!1),t.show()),/false$/i.test(e)&&(t.find("input,textarea,select").prop("disabled",!0),t.hide())}return{init:function(a){d("#content").find("[data-container]").removeClass("d-none"),s.bindForm("update-billing-details-form");var t=s.htmlDecode(d("#page-model").html()),t=JSON.parse(t);const o={currentPlan:t.currentPlan,pendingPlan:t.pendingPlan,paymentMethods:r.observableArray(t.paymentMethods),transactionsAreLoading:r.observable(!0),transactions:r.observableArray()};r.applyBindings(o,d("#content")[0]),d("#update-billing-details-form").on("change","[name=IsCompany]",function(){u()});t=d("#CompanyBillingDetails_CountryName");if(!t.val().length)try{var e=Intl.DateTimeFormat().resolvedOptions().timeZone,n=c.getCountryForTimezone(e);n&&t.val(n.name)}catch(t){}u(),d("#content").on("click","[data-add-payment-method-button]",function(t){t.preventDefault();const e=this;require(["js/stripe/addPaymentMethodModal"],function(t){t.open({organizationId:a,srcElement:e})})}),d("#content").on("click","[data-delete-payment-method]",function(t){t.preventDefault();const e=d(this).closest("[data-payment-method]").attr("data-id"),n=o.paymentMethods().find(t=>t.id===e);require(["js/stripe/deletePaymentMethodModal"],function(t){t.open({organizationId:a,paymentMethodId:e,paymentMethod:n,onComplete:function(t,e){o.paymentMethods(t),e.close(),s.showToast({body:"Payment method has been removed",type:"success"})}})})}),d("#content").on("click","[data-set-as-default-payment-method]",function(t){t.preventDefault();const e=d(this).closest("[data-payment-method]").attr("data-id"),n=o.paymentMethods().find(t=>t.id===e);require(["js/stripe/setAsDefaultPaymentMethodModal"],function(t){t.open({organizationId:a,paymentMethodId:e,paymentMethod:n,onComplete:function(t,e){o.paymentMethods(t),e.close(),s.showToast({body:"Payment methods have been updated",type:"success"})}})})}),d("#content").on("click","[data-upgrade-plan-button]",function(t){t.preventDefault();const e=this,n=d(e).attr("data-plan");require(["js/stripe/upgradePlanModal"],function(t){t.open({organizationId:a,planType:n,srcElement:e})})}),d("#content").on("click","[data-downgrade-plan-button]",function(t){t.preventDefault();const e=this,n=d(e).attr("data-plan");require(["js/stripe/downgradePlanModal"],function(t){t.open({organizationId:a,planType:n,srcElement:e})})}),d("#content").on("shown.bs.tab",'[data-bs-toggle="tab"]',function(t){var e,t=d(t.target).attr("aria-controls");/^paymentHistory-tab-content$/i.test(t)&&(t=a,e=o,p||(p=!0,d.get("/Stripe/LoadTransactions",{organizationId:t}).done(t=>{e.transactions(t)}).fail(function(t){s.showXhrErrorToast(t,!0)}).always(t=>{e.transactionsAreLoading(!1)})))});e=new URLSearchParams(window.location.hash.replace("#","?")),Array.from(e.keys()).length&&history.replaceState("",document.title,window.location.pathname+window.location.search),t=e.get("tab");t&&(n=t,(n=d("#content").find("[data-tabs]").find(`a[href='#${n}']`)).length)&&l.Tab.getOrCreateInstance(n[0]).show();const i=e.get("upgradePlan");i&&require(["js/stripe/upgradePlanModal"],function(t){t.open({organizationId:a,planType:i})})}}});