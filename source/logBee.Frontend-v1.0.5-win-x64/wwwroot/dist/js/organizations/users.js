define(["logBee","jquery","ko","chart-js","luxon","bootstrap"],function(a,r,n,s,d,e){function c(n){require(["js/account/invitationStatusModal"],function(t){return t.open({organizationId:n.organizationId,invitationId:n.invitationId})})}function l(t){t=r("#content").find("[data-tabs]").find(`a[href='#${t}']`),e.Tab.getOrCreateInstance(t[0]).show()}const u={};return{init:function(i){r("#content").find("[data-container]").removeClass("d-none");var t=a.htmlDecode(r("#page-model").html());const e=JSON.parse(t),o={users:n.observableArray(e.users),invitations:n.observableArray(e.invitations)};n.applyBindings(o,r("#content")[0]),r("#content").find("[data-time-ago]").each(function(){a.timeAgoTag(r(this))}),r("#content").on("click","[data-invite-user-button]",function(t){var n;t.preventDefault(),n={organizationId:i,onComplete:function(n,t){/^InvitationSent$/i.test(n.action)&&(o.invitations.remove(t=>t.emailAddress===n.pendingUserInvitation.emailAddress),o.invitations.unshift(n.pendingUserInvitation),l("invitations-tab-content"),c({organizationId:i,invitationId:n.pendingUserInvitation.id})),/^UserAddedToOrganization$/.test(n.action)&&(o.users.unshift({user:n.user}),l("users-tab-content"),a.showToast({body:`${n.user.emailAddress} has been added to ${n.organization.name} organization`,type:"success"},{autohide:!1})),r("#content").find("[data-time-ago]").each(function(){a.timeAgoTag(r(this))}),t.close()}},require(["js/account/inviteUserModal"],function(t){return t.open({organizationId:n.organizationId,onComplete:n.onComplete})})}),r("#content").find("[data-users-table]").find("tbody").children("tr").each(function(){const n=r(this).attr("data-userId");var t=e.users.find(t=>t.user.id===n);t.httpTrafficChartData&&(t=function(t,n){t=t.find("[data-activity-chart]");const i=[];for(var e=0,o=n.intervals.length;e<o;e++)i.push(n.intervals[e].from);t=t[0].getContext("2d");return new s(t,{type:"line",options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!1},verticalLiner:{lineWidth:3,color:"#282c34"}},scales:{y:{beginAtZero:!0,autoSkip:!1,position:"right",ticks:{callback:function(t,n,e){return""}}},x:{grid:{display:!1},ticks:{autoSkip:!1,maxRotation:0,minRotation:0,callback:function(t,n,e){return 0===n||n===i.length-1?(n=this.getLabelForValue(t),d.DateTime.fromISO(n).toFormat("dd MMM")):""}}}},elements:{point:{radius:0},line:{borderWidth:2}}},data:{labels:i,datasets:[{label:"Activity",fill:!0,backgroundColor:"rgb(54, 162, 235)",borderColor:"rgb(54, 162, 235)",data:n.intervals.map(function(e){let i=0;for(let t=0,n=e.value.length;t<n;t++)i+=e.value[t].count;return i})}]}})}(r(this),t.httpTrafficChartData),u[n]=t)}),r("#content").on("click","[data-remove-user]",function(t){t.preventDefault();const e=r(this).closest("tr").attr("data-userId");var n;n={organizationId:i,userId:e,onComplete:function(t,n){u[e]&&(u[e].destroy(),delete u[e]),o.users.remove(t=>t.user.id===e),n.close(),a.showToast({body:t.emailAddress+" has been removed from "+t.organizationName,type:"success"})}},require(["js/account/removeUserModal"],function(t){return t.open({organizationId:n.organizationId,userId:n.userId,onComplete:n.onComplete})})}),r("#content").on("click","[data-open-invitation]",function(t){t.preventDefault();t=r(this).closest("tr").attr("data-invitationId");c({organizationId:i,invitationId:t})}),r("#content").on("click","[data-cancel-invitation]",function(t){t.preventDefault();var n,t=r(this).closest("tr").attr("data-invitationId");n={organizationId:i,invitationId:t,onComplete:function(t,n){const e=t.emailAddress;o.invitations.remove(t=>t.emailAddress===e),n.close(),a.showToast({body:`Invitation for ${e} has been canceled`,type:"success"}),l("invitations-tab-content")}},require(["js/account/cancelInvitationModal"],function(t){return t.open({organizationId:n.organizationId,invitationId:n.invitationId,onComplete:n.onComplete})})})}}});