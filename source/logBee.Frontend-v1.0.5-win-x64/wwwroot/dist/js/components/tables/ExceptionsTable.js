define(["logBee","js/templates","jquery","js/components/searchTable/SearchTable","js/components/searchTable/Column","js/components/searchTable/SortOperator","js/components/searchTable/FilterConstructor","chart-js","luxon","js/chart-utils"],function(t,a,i,o,e,n,s,r,c,l){const d=[new e("tables-exceptions-columns-dateTime-template"),new e("tables-exceptions-columns-exception-template"),new e("tables-exceptions-columns-url-template"),new e("tables-exceptions-columns-chart-template")];const p={applicationId:"",$container:i({}),itemsPerPage:20};return function(e){const n=this;this._options=i.extend(!0,{},p,e);e=a.exceptionsTable();this._options.$container.append(e.html),this._charts=[],this._domId=e.id,this.searchTable=new o({domId:e.id,url:"/Exceptions/SearchExceptions",urlParams:function(){return{applicationId:n._options.applicationId}},columns:d,itemsPerPage:this._options.itemsPerPage}),this.searchTable.addColumnFilter({id:"date",columnName:"Date",field:"LastSeen",fieldType:"number"}),this.searchTable.addColumnFilter({id:"exception",columnName:"Exception",field:"ExceptionMessage",fieldType:"string",hasSort:!1}),this.searchTable.events.on(o.EVENT_TYPES.afterDataSet,function(e){const a=e.instance.getTable();a.find("time").each(function(){t.timeAgoTag(i(this))}),e.instance.getData().forEach(e=>{var t;e.chartData&&(t=a.find(`tr[data-exception-id='${e.exception.id}']`),n._charts.push(function(e,t){for(var e=e.find("[data-exception-chart]"),a=[],n=0,i=t.intervals.length;n<i;n++)a.push(t.intervals[n].from);var e=e[0],o=parseFloat(e.getAttribute("height")),e=e.getContext("2d");return new r(e,{type:"line",options:{responsive:!1,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{intersect:!1,mode:"index",callbacks:{title:function(e,t){e=e[0].label;return c.DateTime.fromISO(e).toFormat("cccc dd, HH:mm")}}},verticalLiner:{lineWidth:3,color:"#282c34"}},scales:{y:{beginAtZero:!0,position:"right",ticks:{callback:function(e,t,a){return 0===t?"":this.getLabelForValue(e)}}},x:{display:!1}},elements:{point:{radius:0},line:{borderWidth:2}}},plugins:[l.verticalLinerPlugin],data:{labels:a,datasets:[{label:"Occurrences",fill:!0,backgroundColor:l.statusCode500BackgroundGradient(e,o),borderColor:l.statusCode500BorderColor(),data:t.intervals.map(function(e){return e.value})}]}})}(t,e.chartData)))})}),this.searchTable.events.on(o.EVENT_TYPES.beforeDataSet,function(e){n._charts.forEach(e=>e.destroy()),n._charts.length=0})}});