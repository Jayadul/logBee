define(["logBee","jquery","js/templates","js/components/searchTable/SortOperator","js/components/searchTable/FilterConstructor"],function(u,l,n,o,r){function s(a){var r=f(a),i=p(a),l=v(a),n=m(a),e=a._searchTable.getQuery(),t=u.getTheme(),o="btn-falcon-default btn-light",t=/^dark/i.test(t)?"btn-falcon-default":"btn-light";i.removeAttr("data-sort-direction").removeAttr("data-has-filter"),r.removeAttr("data-has-filter").find("[data-sort-direction]").removeClass("active"),l.val(""),l.removeClass("input-validation-error is-invalid");let s=!1;e.sort&&e.sort.field===a._field&&(r.find(`[data-sort-direction='${e.sort.direction}']`).addClass("active"),i.attr("data-sort-direction",e.sort.direction),s=!0);var h=e.filter.getCriteria();for(let e=0,t=h.length;e<t;e++){var d=h[e];d.field===a._field&&(l.val(d.value),n.val(d.operator),i.attr("data-has-filter",!0),r.attr("data-has-filter",!0),s=!0)}i.removeClass("active btn-falcon-primary "+o).addClass(t),s&&i.removeClass(o).addClass("active btn-falcon-primary")}const h=[{value:"EqualTo",text:"Equals"},{value:"Contains",text:"Contains",default:!0},{value:"StartsWith",text:"Starts with"},{value:"EndsWith",text:"Ends with"}],d=[{value:"EqualTo",text:"Equal to"},{value:"NotEqualTo",text:"Not equal to"},{value:"GreaterThan",text:"Greater than"},{value:"GreaterOrEqualThan",text:"Greater or equal than",default:!0},{value:"LessThan",text:"Less than"},{value:"LessOrEqualThan",text:"Less or equal than"}],c={$th:l({}),columnName:"",field:"",fieldType:"",hasSort:!0,hasFilter:!0,searchTableInstance:null,placeholder:""},f=function(e){return l("#columnFilterMenu_"+e._domId)},p=function(e){return l("#columnFilterButton_"+e._domId)},v=function(e){return l("#filterValue_"+e._domId)},m=function(e){return l("#filterOperator_"+e._domId)};function e(e){const a=this;if(!(e=l.extend(!0,{},c,e)).columnName.length)throw new Error("columnName must have a value");if(!e.field.length)throw new Error("field must have a value");if(!1===/^(string|number)$/.test(e.fieldType))throw new Error(`fieldType be 'string' or 'number'. Provided value is '${e.fieldType}'`);var t=(r="string"===e.fieldType?h:"number"===e.fieldType?d:[]).find(e=>!0===e.default),r=n.columnFilter({columnName:e.columnName,hasSort:e.hasSort,hasFilter:e.hasFilter,filter:{operators:r},placeholder:e.placeholder}),i=l(r.html),r=(this._thText=e.$th.text().trim(),e.$th.empty().append(i),this._domId=r.id,this._searchTable=e.searchTableInstance,this._field=e.field,this._onQueryChanged=function(){s(a)},this._onThemeChanged=function(){s(a)},this._searchTable.events.on("queryChanged",this._onQueryChanged),u.EVENTS.on("themeChanged",this._onThemeChanged),f(this)),i=p(this);t&&m(this).val(t.value),i.on("shown.bs.dropdown",function(){v(a).select()}),r.on("mousedown click",function(e){e.stopPropagation()}),r.on("click","[data-sort-direction]",function(e){e.preventDefault();e=l(this).attr("data-sort-direction");a._searchTable.applySort(new o(a._field,e)),a._closePopup()}),r.on("click","[data-clear-filter-button]",function(e){e.preventDefault(),a._clearFilter()});t=(e=l("#columnFilterForm_"+this._domId)).attr("id");e.length&&(e.submit(function(e){return e.preventDefault(),!1}),l.validator.unobtrusive.parse("#"+t),e.data("validator").settings.submitHandler=function(e,t){return a._applyFilter(),!1})}return e.prototype._applyFilter=function(){var e=v(this).val(),t=m(this).val(),a=this._searchTable.getQuery();a.filter.addOrUpdate(new r.Criterion(this._field,t,e)),this._searchTable.applyFilter(a.filter),this._closePopup()},e.prototype._clearFilter=function(){var e=this._searchTable.getQuery();e.filter.remove(this._field),this._searchTable.applyFilter(e.filter),this._closePopup()},e.prototype._closePopup=function(){l("body").click()},e.prototype.destroy=function(){this._searchTable.events.off("queryChanged",this._onQueryChanged),u.EVENTS.off("themeChanged",this._onThemeChanged);var e=p(this),t=f(this),a=e.closest("th");t.remove(),e.remove(),a.text(this._thText)},e});