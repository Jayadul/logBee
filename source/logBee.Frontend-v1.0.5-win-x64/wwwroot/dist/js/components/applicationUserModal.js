define(["logBee","jquery","ko","js/components/Modal","chart-js","luxon","js/chart-utils","js/components/tables/RequestsTable","js/components/searchTable/FilterConstructor","js/components/searchTable/SortOperator"],function(r,i,l,t,s,c,d,u,p,f){function e(o){o=i.extend(!0,{},a,o);var e=new t;e.events.on(t.EVENT_TYPES.build,function(e){const t=e.instance;var e=t.getElement(),a=r.htmlDecode(e.find("[data-model]").html()),a=JSON.parse(a),e=(t._viewModel={applicationUser:a.applicationUser},l.applyBindings(t._viewModel,e[0]),e.find(".container-fluid").each(function(){i(this).children(".row").each(function(e,t){e%2==0&&i(this).addClass("bg-200")})}),e.find("[data-time-ago]").each(function(){r.timeAgoTag(i(this))}),t._httpTrafficChartData=function(e,t){for(var e=e.find("[data-http-traffic-chart]"),a=[],n=0,o=t.intervals.length;n<o;n++)a.push(t.intervals[n].from);e=e[0].getContext("2d");return new s(e,{type:"line",options:{onResize:function(e,t){t=t.width;const n=600<=t?2:480<=t?3:4;e.options.scales.x.ticks.callback=function(e,t,a){return(e+1)%n!=0?null:(e=this.getLabelForValue(e),c.DateTime.fromISO(e).toFormat("dd-MM"))}},responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{intersect:!1,mode:"index",callbacks:{title:function(e,t){e=e[0].label;return c.DateTime.fromISO(e).toFormat("dd MMMM")}}},verticalLiner:{lineWidth:3,color:"#282c34"}},scales:{y:{beginAtZero:!0,position:"right"},x:{ticks:{}}},elements:{point:{radius:0},line:{borderWidth:2}}},plugins:[d.verticalLinerPlugin],data:{labels:a,datasets:[{label:"Server errors",fill:!0,backgroundColor:d.statusCode500BackgroundGradient(e,100),borderColor:d.statusCode500BorderColor(),data:t.intervals.map(function(a){let n=0;for(let e=0,t=a.value.length;e<t;e++)500<=a.value[e].httpStatusCode&&(n+=a.value[e].count);return n})},{label:"Client errors",fill:!0,backgroundColor:d.statusCode400BackgroundGradient(e,100),borderColor:d.statusCode400BorderColor(),data:t.intervals.map(function(a){let n=0;for(let e=0,t=a.value.length;e<t;e++)400<=a.value[e].httpStatusCode&&a.value[e].httpStatusCode<500&&(n+=a.value[e].count);return n})},{label:"Success",fill:!0,backgroundColor:d.statusCode200BackgroundGradient(e,100),borderColor:d.statusCode200BorderColor(),data:t.intervals.map(function(a){let n=0;for(let e=0,t=a.value.length;e<t;e++)a.value[e].httpStatusCode<400&&(n+=a.value[e].count);return n})}]}})}(e,a.httpTrafficChartData),new u({$container:e.find("[data-requests-table-container]"),urlParams:function(){return{applicationId:o.applicationId}},itemsPerPage:10})),n=(e.searchTable.events.on("afterDataSet",function(e){t._requestsTable.getContainer().find("[data-clear-filters-button]").remove()}),new p),a=(n.addOrUpdate(new p.Criterion("Username","EqualTo",a.applicationUser.user.name)),new f("StartDateTime","desc"));e.searchTable.applyFilter(n),e.searchTable.applySort(a),t._requestsTable=e}),e.events.on(t.EVENT_TYPES.destroy,function(e){var t=e.instance.getElement();e.instance._httpTrafficChartData&&e.instance._httpTrafficChartData.destroy(),e.instance._requestsTable&&e.instance._requestsTable.destroy(),l.disposeKoViewModel(e.instance._viewModel,t)}),e.load("/Components/ApplicationUserModal",{applicationId:o.applicationId,name:o.name})}const a={applicationId:"",name:""};return new function(){this.open=e}});