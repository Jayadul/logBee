define(["logBee","js/chart-utils","jquery","bootstrap","chart-js","luxon"],function(i,n,r,l,s,d){const a={dashboardApplication:null};function t(t){t=r.extend(!0,{},a,t);const o=this;this._dashboardApplication=t.dashboardApplication,this._httpTrafficChart=null,this.getElement().on("click","[data-reload-button]",function(t){t.preventDefault();{var a=o;t=this;const e=l.Button.getOrCreateInstance(t);e.toggleDisabled(!0),r.get("/Dashboard/LoadApplicationData",{applicationId:a._dashboardApplication.applicationId}).done(t=>{a.setData(t.preloadedData)}).fail(function(t){i.showXhrErrorToast(t,!0)}).always(t=>{e.toggleDisabled(!1)})}}),this._bind()}return t.prototype.setData=function(t){this.destroy(),this._dashboardApplication.preloadedData(t),this._dashboardApplication.wasApplicationDataPreloaded(!0),this._bind()},t.prototype.getElement=function(){return r("#applicationCard_"+this._dashboardApplication.applicationId)},t.prototype._bind=function(){var t=this._dashboardApplication.preloadedData(),a=this.getElement();t&&(this._httpTrafficChart=function(t,a){for(var e=[],o=0,i=a.intervals.length;o<i;o++)e.push(a.intervals[o].to);var t=document.getElementById("applicationHttpTrafficChart_"+t),r=parseFloat(t.getAttribute("height")),t=t.getContext("2d");return new s(t,{type:"line",options:{onResize:function(t,a){a=a.width;const o=600<=a?2:480<=a?3:4;t.options.scales.x.ticks.callback=function(t,a,e){return(t+1)%o!=0?null:(t=this.getLabelForValue(t),d.DateTime.fromISO(t).toFormat("HH:mm"))}},responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{intersect:!1,mode:"index",callbacks:{title:function(t,a){t=t[0].label,t=d.DateTime.fromISO(t);return t.minus({hour:1}).toFormat("HH:mm")+" - "+t.toFormat("HH:mm")}}},verticalLiner:{lineWidth:3,color:"#282c34"}},scales:{y:{beginAtZero:!0},x:{ticks:{}}},elements:{point:{radius:0},line:{borderWidth:2}}},plugins:[n.verticalLinerPlugin],data:{labels:e,datasets:[{label:"Server errors",fill:!0,backgroundColor:n.statusCode500BackgroundGradient(t,r),borderColor:n.statusCode500BorderColor(),data:a.intervals.map(function(e){let o=0;for(let t=0,a=e.value.length;t<a;t++)500<=e.value[t].httpStatusCode&&(o+=e.value[t].count);return o})},{label:"Client errors",fill:!0,backgroundColor:n.statusCode400BackgroundGradient(t,r),borderColor:n.statusCode400BorderColor(),data:a.intervals.map(function(e){let o=0;for(let t=0,a=e.value.length;t<a;t++)400<=e.value[t].httpStatusCode&&e.value[t].httpStatusCode<500&&(o+=e.value[t].count);return o})},{label:"Success",fill:!0,backgroundColor:n.statusCode200BackgroundGradient(t,r),borderColor:n.statusCode200BorderColor(),data:a.intervals.map(function(e){let o=0;for(let t=0,a=e.value.length;t<a;t++)e.value[t].httpStatusCode<400&&(o+=e.value[t].count);return o})}]}})}(this._dashboardApplication.applicationId,t.httpTraffic)),a.find("[data-time-ago]").each(function(){i.timeAgoTag(r(this))})},t.prototype.destroy=function(){this._httpTrafficChart&&this._httpTrafficChart.destroy()},t});