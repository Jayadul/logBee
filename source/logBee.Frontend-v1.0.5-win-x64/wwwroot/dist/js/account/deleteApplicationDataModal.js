define(["logBee","jquery","ko","js/components/Modal","js/formatFileContent"],function(s,p,o,t,a){function e(i){i=p.extend(!0,{},n,i);var e=new t;e.events.on(t.EVENT_TYPES.build,function(e){window[r]=e.instance;var t=e.instance,e=e.instance.getElement(),a=s.htmlDecode(e.find("[data-model]").html()),a=JSON.parse(a);const n=c(i.categories);a=a.allKeys.filter(e=>!n.includes(e)).filter(e=>l.indexOf(e)<0);a.length&&i.categories.push({name:"Other data",children:a.map(e=>({name:e,keys:[e]}))}),s.bindForm("delete-application-data-form"),p("#delete-application-data-form").data("validator").settings.submitHandler=function(e,t){var n=p(e);s.toggleFormLoading(n,!0);{(n=p(e)).children("[data-hidden-fields]").remove(),n.prepend("<div data-hidden-fields=''></div>");var i=n.children("[data-hidden-fields]");i.length&&i.empty();let a=[];n.find("input[name=keys]:checked").each(function(){var e=p(this).attr("data-value").split(",");a=[...a,...e]});for(let e=0,t=(a=a.filter((e,t)=>a.indexOf(e)===t)).length;e<t;e++){var o=p(`<input type='hidden' name='SelectedKeys[${e}]' />`).val(a[e]);i.append(o[0].outerHTML)}}return!0},t._viewModel={categories:i.categories},o.applyBindings(t._viewModel,e[0])}),e.events.on(t.EVENT_TYPES.destroy,function(e){delete window[r];var t=e.instance.getElement();o.disposeKoViewModel(e.instance._viewModel,t)}),e.load("/Account/DeleteApplicationDataModal",{applicationId:i.applicationId})}const r="deleteApplicationDataModal",l=["AlertDefinitionInvocation","ApplicationChartData"],n=(window.onDeleteApplicationDataComplete=function(e,t){s.toggleFormLoading(this,!1),"success"!==t&&s.showXhrErrorToast(e),"success"===t&&(t=window[r])&&((t=t.getElement()).find("[data-container]").html(e.responseText),t.find("pre").each(function(){const t=p(this);a.highlightContent(t.text()).then(e=>{e&&t.html(e)})}))},{applicationId:"",categories:[{name:"Chart data",children:[{name:"Alerts",keys:["ApplicationChartData.ApplicationAlerts"]},{name:"Http traffic",keys:["ApplicationChartData.HttpTraffic"]},{name:"Exceptions",keys:["ApplicationChartData.ExceptionTypes","ApplicationChartData.Exceptions"]},{name:"Endpoints",keys:["ApplicationChartData.Endpoints"]},{name:"Users",keys:["ApplicationChartData.UsersHttpTraffic","ApplicationChartData.Sessions"]},{name:"Referring sites",keys:["ApplicationChartData.HttpRefererSources"]}]},{name:"Application data",children:[{name:"Hosts",keys:["ApplicationData.Hosts"]},{name:"Referring sites",keys:["ApplicationData.HttpReferrers","ApplicationChartData.HttpRefererSources","HttpRefererSource","HttpRefererDestination"]},{name:"User agents",keys:["ApplicationData.UserAgents"]}]},{name:"Alerts",keys:["ApplicationAlert","ApplicationChartData.ApplicationAlerts"]},{name:"Exceptions",keys:["ApplicationException","ApplicationChartData.ExceptionTypes","ApplicationChartData.Exceptions"]},{name:"Requests",keys:["RequestLog","ApplicationFile"]},{name:"Endpoints",keys:["ApplicationEndpoint","ApplicationChartData.Endpoints"]},{name:"Users",keys:["ApplicationUser","ApplicationChartData.UsersHttpTraffic","ApplicationChartData.Sessions"]}]}),c=function(a){let n=[];for(let e=0,t=a.length;e<t;e++){var i=a[e];i.keys&&(n=[...n,...i.keys]),i.children&&(n=[...n,...c(i.children)])}return n.filter((e,t)=>n.indexOf(e)===t)};return new function(){this.open=e}});